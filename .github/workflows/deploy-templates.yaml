name: Execute FlagOps Templates
on:
    push:
        branches: [main]
    workflow_dispatch:
jobs:
    build:
        concurrency:
            group: ci-manifests
            cancel-in-progress: true
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-go@v4
              with:
                go-version: '1.20'
            - name: Install FlagOps
              run: go install github.com/graytonio/flagops@v0.1.7
            - name: Setup SSH Agent
              uses: webfactory/ssh-agent@v0.9.0
              with:
                ssh-private-key: ${{ secrets.DEPLOY_SSH_KEY }}
            - name: Run FlagOps
              run: |
                git config user.name "FlagOps"
                git config user.email "flagops@flagops.io"
                git config --unset-all http.https://github.com/.extraheader
                flagops